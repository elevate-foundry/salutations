<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Analytics - Salutations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #888;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }
        
        .visitors-table {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #667eea;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #ccc;
        }
        
        tr:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .visitor-id {
            font-family: monospace;
            color: #764ba2;
        }
        
        .clear-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 20px;
        }
        
        .clear-btn:hover {
            opacity: 0.9;
        }
        
        .privacy-notice {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 30px;
        }
        
        .privacy-notice h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .privacy-notice p {
            color: #aaa;
            line-height: 1.6;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 10px;
            margin-top: 20px;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 20px;
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #888;
            white-space: nowrap;
        }
        
        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Visitor Analytics</h1>
        <p class="subtitle">Device fingerprinting and visitor tracking for Salutations</p>
        
        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-visits">0</div>
                <div class="stat-label">Total Visits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-visitors">0</div>
                <div class="stat-label">Unique Visitors</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-screen">-</div>
                <div class="stat-label">Avg Screen Size</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="top-browser">-</div>
                <div class="stat-label">Top Browser</div>
            </div>
        </div>
        
        <div class="chart-container">
            <h3>Platform Distribution</h3>
            <div class="bar-chart" id="platform-chart"></div>
        </div>
        
        <div class="visitors-table">
            <h3>Recent Visitors</h3>
            <table id="visitors-table">
                <thead>
                    <tr>
                        <th>Visitor ID</th>
                        <th>Timestamp</th>
                        <th>Screen</th>
                        <th>Platform</th>
                        <th>Browser</th>
                        <th>Page</th>
                    </tr>
                </thead>
                <tbody id="visitors-tbody">
                </tbody>
            </table>
            
            <button class="clear-btn" onclick="clearAnalytics()">Clear Analytics Data</button>
        </div>
        
        <div class="privacy-notice">
            <h3>üîí Privacy Notice</h3>
            <p>
                This analytics system uses device fingerprinting to track unique visitors. 
                Data collected includes screen resolution, browser information, platform details, 
                and device capabilities. All data is stored locally in your browser's localStorage 
                and is never sent to external servers. This is for demonstration purposes only.
            </p>
            <p style="margin-top: 10px;">
                <strong>Data collected:</strong> Screen properties, browser info, WebGL fingerprint, 
                canvas fingerprint, audio fingerprint, timezone, fonts, and storage capabilities.
            </p>
        </div>
    </div>
    
    <script>
        // Load and display analytics data
        function loadAnalytics() {
            try {
                const stored = localStorage.getItem('salutations_visitors') || '[]';
                const visitors = JSON.parse(stored);
                
                // Calculate statistics
                const totalVisits = visitors.length;
                const uniqueVisitors = new Set(visitors.map(v => v.visitorId)).size;
                
                // Update stats
                document.getElementById('total-visits').textContent = totalVisits;
                document.getElementById('unique-visitors').textContent = uniqueVisitors;
                
                // Calculate average screen size
                if (visitors.length > 0) {
                    const avgWidth = Math.round(visitors.reduce((sum, v) => sum + v.fingerprint.screen.width, 0) / visitors.length);
                    const avgHeight = Math.round(visitors.reduce((sum, v) => sum + v.fingerprint.screen.height, 0) / visitors.length);
                    document.getElementById('avg-screen').textContent = `${avgWidth}x${avgHeight}`;
                    
                    // Find top browser
                    const browsers = visitors.map(v => {
                        const ua = v.fingerprint.browser.userAgent;
                        if (ua.includes('Chrome')) return 'Chrome';
                        if (ua.includes('Firefox')) return 'Firefox';
                        if (ua.includes('Safari')) return 'Safari';
                        if (ua.includes('Edge')) return 'Edge';
                        return 'Other';
                    });
                    
                    const browserCounts = browsers.reduce((acc, b) => {
                        acc[b] = (acc[b] || 0) + 1;
                        return acc;
                    }, {});
                    
                    const topBrowser = Object.entries(browserCounts).sort((a, b) => b[1] - a[1])[0];
                    document.getElementById('top-browser').textContent = topBrowser ? topBrowser[0] : '-';
                    
                    // Platform distribution chart
                    const platforms = visitors.map(v => v.fingerprint.browser.platform);
                    const platformCounts = platforms.reduce((acc, p) => {
                        acc[p] = (acc[p] || 0) + 1;
                        return acc;
                    }, {});
                    
                    drawPlatformChart(platformCounts);
                }
                
                // Display recent visitors (last 20)
                const tbody = document.getElementById('visitors-tbody');
                tbody.innerHTML = '';
                
                visitors.slice(-20).reverse().forEach(visitor => {
                    const row = tbody.insertRow();
                    
                    row.insertCell().innerHTML = `<span class="visitor-id">${visitor.visitorId.substring(0, 8)}...</span>`;
                    row.insertCell().textContent = new Date(visitor.timestamp).toLocaleString();
                    row.insertCell().textContent = `${visitor.fingerprint.screen.width}x${visitor.fingerprint.screen.height}`;
                    row.insertCell().textContent = visitor.fingerprint.browser.platform;
                    
                    const ua = visitor.fingerprint.browser.userAgent;
                    let browser = 'Unknown';
                    if (ua.includes('Chrome')) browser = 'Chrome';
                    else if (ua.includes('Firefox')) browser = 'Firefox';
                    else if (ua.includes('Safari')) browser = 'Safari';
                    else if (ua.includes('Edge')) browser = 'Edge';
                    
                    row.insertCell().textContent = browser;
                    row.insertCell().textContent = visitor.page || '/';
                });
                
            } catch (e) {
                console.error('Error loading analytics:', e);
            }
        }
        
        // Draw platform distribution chart
        function drawPlatformChart(platformCounts) {
            const chart = document.getElementById('platform-chart');
            chart.innerHTML = '';
            
            const total = Object.values(platformCounts).reduce((a, b) => a + b, 0);
            const maxCount = Math.max(...Object.values(platformCounts));
            
            Object.entries(platformCounts).forEach(([platform, count]) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${(count / maxCount) * 100}%`;
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = platform;
                
                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = count;
                
                bar.appendChild(label);
                bar.appendChild(value);
                chart.appendChild(bar);
            });
        }
        
        // Clear analytics data
        function clearAnalytics() {
            if (confirm('Are you sure you want to clear all analytics data?')) {
                localStorage.removeItem('salutations_visitors');
                localStorage.removeItem('salutations_visitor_id');
                loadAnalytics();
                alert('Analytics data cleared!');
            }
        }
        
        // Load analytics on page load
        loadAnalytics();
        
        // Refresh every 5 seconds
        setInterval(loadAnalytics, 5000);
    </script>
</body>
</html>
